---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.4.2
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

We need to execute the *ipython* magic twice.  We do not know why.  Once is not enough.  If you add a comment before the *ipython* magic, even twice is not enough.

```{python}
from scipy import *
import numpy as np
from numpy.random import rand, uniform
import matplotlib.pyplot as plt
import matplotlib.animation
import PlanktonSignaling.basics as PS
import PlanktonSignaling.BlobDetection as BD
import PlanktonSignaling.Deposition as DP
import profile
import time

# %matplotlib notebook
# %matplotlib notebook

# #%load_ext Cython
```

Note here that $d_1 = \frac{\kappa \lambda_0}{v^2}$ and $d_2 = \frac{\beta}{\lambda_0}$. For the correct deposition functions, use linAtanDep2 and atanDep2 to include tanh.

```{python}
def testF(x,y):
    return(cos((x+pi/10)*4*pi/10)*cos(y*6*pi/10))

def testD2F(x,y):
    return(-((4*pi/10)**2 + (6*pi/10)**2)*cos((x+pi/10)*4*pi/10)*cos(y*6*pi/10))

field = PS.Background_Field(N=50,depMaxStr=.01,Const=3,L=10,k=0.02,epsilon=1e-3,depThreshold=0.05, depTransWidth=0.03, num = 30**2, 
                            c0=0.012,d1=1,d2=0.05)

testFunction = testF(field.xm,field.ym)

D2testFunction = testD2F(field.xm,field.ym)

testFunction2 = field.M1.dot(testFunction.reshape(field.N**2,))
testFunction2 = testFunction2.reshape(field.N,field.N)

err = testFunction2-(testFunction-0.5*(field.d1*field.k)*D2testFunction+0.5*field.k*field.d2*testFunction)
#err = testFunction2/testFunction

```

```{python}
plt.figure()
plt.pcolormesh(field.xm,field.ym,err)
plt.colorbar()
#plt.contour(field.xm,field.ym,testFunction)
plt.show()
```

```{python}
field.scalar = testFunction
field.BuildPeriodic()
```

```{python}
plt.figure()
plt.pcolormesh(field.xm_periodic,field.ym_periodic,field.scalar_periodic)
plt.colorbar()
#plt.contour(field.xm,field.ym,testFunction)
plt.show()
```

```{python}
plt.figure()
plt.pcolormesh(field.xm,field.ym,field.scalar.reshape((50,50)))
plt.colorbar()
#plt.contour(field.xm,field.ym,testFunction)
plt.show()
```

```{python}

```
