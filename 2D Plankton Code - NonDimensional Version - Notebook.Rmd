---
jupyter:
  jupytext:
    text_representation:
      extension: .Rmd
      format_name: rmarkdown
      format_version: '1.2'
      jupytext_version: 1.4.2
  kernelspec:
    display_name: Python 3
    language: python
    name: python3
---

```{python}
from scipy import *
import numpy as np
from numpy.random import rand
import matplotlib.pyplot as plt
import matplotlib.animation
import PlanktonSignaling.basicsNonDimensional as PS
import PlanktonSignaling.BlobDetection as BD
import PlanktonSignaling.Deposition as DP
import profile

# %matplotlib notebook

# #%load_ext Cython
```

Note here that $d_1 = \frac{\kappa \lambda_0}{v^2}$ and $d_2 = \frac{\beta}{\lambda_0}$. For the correct deposition functions, use linAtanDep2 and atanDep2 to include tanh.

```{python}
meshsize = 60
Swimmers = PS.Plankton(DP.linAtanDep2,N = meshsize,depMaxStr=8.0e-4,Const=3,L=10,k=0.02,speed=0.2,
                    lambda0=4,kappa=.8e-3,beta=1,depTransWidth=0.0001,depThreshold=0.001)

def initial_conditions(x,y):
    return(0*x)

print(Swimmers.d1)
print(Swimmers.d2)
```

```{python}
Swimmers.SetIC(initial_conditions)

pos = [array([0.1,0.1])]
aggreg = [array([0,0])]
areaAve = [array([0,0])]

th = rand()*2*pi
vel = [array([cos(th),sin(th)])]

for l in range(0,20):
    for k in range(0,20):
        pos = np.append(pos,[array([mod(k*(Swimmers.L*0.05) + 0.01*(rand()-0.5) + (Swimmers.L*0.05),Swimmers.L),
                                  mod(l*(Swimmers.L*0.05) + 0.01*(rand()-0.5) + (Swimmers.L*0.05),Swimmers.L)])],axis=0)
        th  = rand()*2*pi
        vel = np.append(vel,[array([cos(th),sin(th)])],axis=0)

plt.figure()
plt.pcolormesh(Swimmers.xm,Swimmers.ym,Swimmers.Meshed())
plt.plot(pos[:,0],pos[:,1],'ro')
plt.colorbar()
plt.show()
```

```{python}
time = 20

pos_store = list([pos[:,:]])
pos_store = list([np.array(pos)])
scalar_store = list([Swimmers.Meshed()])
aggreg = np.array([0,0])

count = 1
for plot in range(0,1):
    for k in range(0,time):
        Swimmers.Update(Swimmers.scalar,pos,vel)
        pos_store.append(np.array(pos))
        scalar_store.append(Swimmers.Meshed())
        
        #Counts the Number of Aggregations at time k
        
        aggreg = np.vstack((aggreg,[k+1,BD.countingAll(1,255,BD.Contour(Swimmers,pos,400,meshsize))]))  
```

# Animations

```{python}
fig   = plt.figure()
ax    = plt.subplot(1,1,1)
field = ax.pcolormesh(Swimmers.xm,Swimmers.ym,scalar_store[1])
field.set_clim(0,.0032)
dots, = ax.plot([], [], 'ro')
fig.colorbar(field)

def initit():
    dots.set_data([], [])
    return field,dots

def animate(k):
    arr = scalar_store[k]
    arr = arr[:-1, :-1]
    field.set_array(arr.ravel())
    plt.title(r'Time = ${0}$'.format(k), fontsize = 20)
    dots.set_data(pos_store[k][:,0],pos_store[k][:,1])

    return field,dots,
    
anim = matplotlib.animation.FuncAnimation(fig,animate,frames=range(0,len(scalar_store),2),
                                          interval=80,blit=False,repeat=False)

# Uncomment if you want to save it to a file.  Requires mencoder or ffmpeg or some writer utility to generate the file.
#anim.save('New_Movie.mp4', writer='ffmpeg')
plt.show()
```
